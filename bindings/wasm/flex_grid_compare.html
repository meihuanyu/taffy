<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>Taffy Flex/Grid 对比演示</title>
  <style>
    body {
      display: flex;
      gap: 32px;
      font-family: sans-serif;
    }

    .case-row {
      display: flex;
      gap: 32px;
      margin-bottom: 32px;
      align-items: flex-start;
    }

    .case-col {
      flex: 1;
      padding: 8px;
      border: 1px solid #eee;
      border-radius: 8px;
      background: #fafbfc;
      min-width: 0;
    }

    .case-title {
      font-weight: bold;
      margin-bottom: 8px;
    }

    .column {
      flex: 1;
      padding: 16px;
      border: 1px solid #ccc;
    }

    .demo-title {
      font-weight: bold;
      margin-bottom: 8px;
    }

    .flex-demo,
    .grid-demo {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .native-flex,
    .native-grid {
      margin-top: 8px;
    }

    .native-flex>div {
      flex: 1;
      background: #aaf;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      font-weight: bold;
    }

    .box-label {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      pointer-events: none;
    }

    .native-box {
      position: relative;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      background: linear-gradient(135deg, #e0f7fa 60%, #b2ebf2 100%);
      min-width: 24px;
      min-height: 24px;
      transition: box-shadow 0.2s;
    }

    .native-box.root {
      border-color: #f90;
      background: linear-gradient(135deg, #fff3e0 60%, #ffe0b2 100%);
    }


    .bbox-label {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #333;
      pointer-events: none;
    }

    pre {
      background: #f8f8f8;
      padding: 8px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="column">
    <div class="demo-title">Flex 用例对比</div>
    <div id="flex-cases-list"></div>
    <div class="demo-title">Grid 用例对比</div>
    <div id="grid-cases-list"></div>
  </div>
  <script type="module">
    import init, * as Taffy from './pkg/taffy_layout.js';
    await init();
    import { buildTaffyFromJson, buildHtmlFromJson, renderBboxes, loadJsonList } from './utils.js';

    const flexCases = await loadJsonList('./data/flex_cases.json');
    const gridCases = await loadJsonList('./data/grid_cases.json');

    function renderAllCases(type, cases, listId) {
      const list = document.getElementById(listId);
      list.innerHTML = '';
      cases.forEach((item, idx) => {
        const row = document.createElement('div');
        row.className = 'case-row';
        // 左侧 Taffy
        const col1 = document.createElement('div');
        col1.className = 'case-col';
        const title = document.createElement('div');
        title.className = 'case-title';
        title.textContent = `${type === 'flex' ? 'Flex' : 'Grid'}用例${idx + 1}：${item.name}`;
        col1.appendChild(title);
        const bboxView = document.createElement('div');
        bboxView.style.position = 'relative';
        bboxView.style.width = (item.json.width && item.json.width.unit === 'px' ? item.json.width.val : 400) + 'px';
        bboxView.style.height = (item.json.height && item.json.height.unit === 'px' ? item.json.height.val : 120) + 'px';
        bboxView.style.marginBottom = '8px';
        col1.appendChild(bboxView);
        // Taffy 渲染
        const tree = new Taffy.TaffyTree();
        const root = buildTaffyFromJson(item.json, tree, Taffy);
        const layout = root.computeLayout({
          width: item.json.width && item.json.width.unit === 'px' ? item.json.width.val : undefined,
          height: item.json.height && item.json.height.unit === 'px' ? item.json.height.val : undefined,
        });
        renderBboxes(layout, bboxView, ['#f00', '#0a0', '#00f']);
        // 右侧 原生 HTML
        const col2 = document.createElement('div');
        col2.className = 'case-col';
        const title2 = document.createElement('div');
        title2.className = 'case-title';
        title2.textContent = `${type === 'flex' ? 'Flex' : 'Grid'}用例${idx + 1}：${item.name}`;
        col2.appendChild(title2);
        const nativeView = buildHtmlFromJson(item.json);
        nativeView.style.marginBottom = '8px';
        col2.appendChild(nativeView);
        // 合并
        row.appendChild(col1);
        row.appendChild(col2);
        list.appendChild(row);
      });
    }

    renderAllCases('flex', flexCases, 'flex-cases-list');
    renderAllCases('grid', gridCases, 'grid-cases-list');

  </script>
</body>

</html>